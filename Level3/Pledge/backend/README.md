### `pledge-backend`

---

### 项目简介

`pledge-backend` 是一个基于区块链的后端服务项目，主要用于管理质押池（Pledge Pool）和代币的相关数据。项目分为两个主要部分：

1. **API 服务**：提供对外的 HTTP 和 WebSocket 接口，供前端或其他服务调用。
2. **定时任务服务**：通过调度器定期执行任务，如数据同步、监控和区块链交互。

该项目适用于去中心化金融（DeFi）平台、区块链资产管理系统或其他需要实时数据同步和监控的场景。

---

### 项目功能模块

#### **1. API 服务**

API 服务是项目的核心部分，提供了以下功能：

- **质押池管理**：
  - 查询质押池的基础信息和动态信息。
  - 支持质押池的搜索和多签设置。
- **代币管理**：
  - 查询代币列表及其详细信息（如符号、价格、Logo 等）。
- **实时价格推送**：
  - 通过 WebSocket 实现实时价格更新推送。
- **用户管理**：
  - 用户登录和登出功能。
- **多签管理**：
  - 设置和获取多签账户信息。

#### **2. 定时任务服务**

定时任务服务通过 `gocron` 调度器定期执行以下任务：

- **质押池数据同步**：
  - 定期从区块链获取质押池信息并更新到数据库。
- **代币价格更新**：
  - 从主网和测试网获取代币价格，并同步到数据库和 Redis。
  - 将价格数据写入区块链合约。
- **代币符号和 Logo 更新**：
  - 获取代币的符号和 Logo 信息，并更新到数据库和缓存。
- **账户余额监控**：
  - 检查账户或合约的余额是否低于阈值，余额不足时发送警告通知。
- **Redis 数据清理**：
  - 在任务启动时清空 Redis 数据库，确保数据一致性。

---

### 项目技术栈

#### **1. 编程语言**

- **Go**：高性能、并发友好的编程语言，适合构建后端服务。

#### **2. 框架和库**

- **Gin**：用于构建 API 服务的高性能 Web 框架。
- **gocron**：用于定时任务调度的轻量级库。
- **go-ethereum**：用于与区块链节点交互的 Go 库。
- **gorm**：用于操作 MySQL 数据库的 ORM 框架。
- **Redis**：用于缓存高频访问的数据（如代币价格、符号等）。

#### **3. 数据存储**

- **MySQL**：存储质押池、代币等核心数据。
- **Redis**：用于缓存代币价格、符号等高频访问数据。

#### **4. 日志管理**

- 自定义日志模块，用于记录任务执行和错误信息。

#### **5. 邮件通知**

- 在余额不足等情况下发送警告邮件。

---

### 项目运行方式

#### **1. 启动 API 服务**

```bash
go mod tidy
cd api
go run pledge_api.go
```

- 启动后提供 HTTP 和 WebSocket 接口，供前端或其他服务调用。

#### **2. 启动定时任务服务**

```bash
set plgr_admin_private_key=XXXXXXXXXXXXXXXXXXXXXXXXXX

cd schedule
go run pledge_task.go
```

- 启动后会立即执行初始化任务，并根据调度器配置定期执行任务。

---

### 项目功能详细说明

#### **1. 质押池管理**

- **基础信息查询**：
  - 提供质押池的 ID、链 ID、借贷代币、利率、状态等基础信息。
- **动态信息查询**：
  - 提供质押池的实时数据，如当前借贷供应量、质押率等。
- **多签设置**：
  - 支持设置和获取质押池的多签账户信息。

#### **2. 代币管理**

- **代币符号和价格更新**：
  - 从区块链获取代币的符号和价格，并同步到数据库和 Redis。
- **代币 Logo 更新**：
  - 获取代币的 Logo 信息，并更新到数据库和缓存。
- **代币列表查询**：
  - 提供代币的名称、符号、价格、Logo 等详细信息。

#### **3. 实时价格推送**

- **WebSocket 实现**：
  - 通过 WebSocket 向客户端推送代币的实时价格更新。
- **心跳检测**：
  - 定期检测客户端连接的活跃性，确保实时推送的稳定性。

#### **4. 账户余额监控**

- **余额检查**：
  - 定期检查账户或合约的余额是否低于设定的阈值。
- **邮件通知**：
  - 当余额不足时，生成警告邮件并发送给相关人员。

#### **5. 区块链交互**

- **价格写入区块链**：
  - 将代币价格写入区块链合约，供其他智能合约或服务使用。
- **ABI 文件管理**：
  - 自动下载和存储代币的 ABI 文件，便于后续调用合约方法。

---

### 项目适用场景

- **区块链质押平台**：
  - 管理质押池信息，支持用户查询和操作。
- **代币管理平台**：
  - 实时同步代币价格、符号和其他信息。
- **区块链监控系统**：
  - 监控账户余额，确保资金安全。
- **实时数据推送**：
  - 通过 WebSocket 实现价格等数据的实时推送。

---

### 项目优势

1. **模块化设计**：
   - 项目分为 API 服务和定时任务服务，职责清晰，便于扩展和维护。
2. **高性能**：
   - 使用 Go 语言和高效的框架（如 Gin 和 gocron），支持高并发和低延迟。
3. **实时性**：
   - 支持实时数据推送和定时任务调度，确保数据的及时性和一致性。
4. **多链支持**：
   - 支持主网和测试网的代币管理和区块链交互。
5. **安全性**：
   - 提供账户余额监控和邮件通知功能，确保资金安全。

---

### 总结

`pledge-backend` 是一个功能全面的区块链后端服务，集成了质押池管理、代币管理、实时数据推送和定时任务调度等功能。它适用于需要高频数据同步、实时推送和区块链交互的场景，例如去中心化金融（DeFi）平台或区块链资产管理系统。项目结构清晰，模块化设计便于扩展和维护，是一个高效、可靠的区块链后端解决方案。
